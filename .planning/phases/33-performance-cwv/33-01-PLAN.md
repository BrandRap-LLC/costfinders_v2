---
phase: 33-performance-cwv
plan: 01
type: execute
domain: next-js
---

<objective>
Optimize Core Web Vitals (LCP, CLS, INP) and overall performance for SEO pages.

Purpose: Improve search rankings through better performance scores and enhance user experience on location/category pages.
Output: Optimized font loading, image handling, and loading states for key landing pages.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/32-content-optimization/32-01-SUMMARY.md

**Codebase Context:**
- Next.js 16.1.1 with App Router, SSR/SSG
- Manrope font via next/font/google (currently no display optimization)
- Images set to `unoptimized: true` for Cloudinary handling
- 39 client components in app directory
- BlurredImage component uses next/image
- SEO pages (state, city, category) are static with generateStaticParams

**Performance Targets:**
- LCP (Largest Contentful Paint): < 2.5s
- CLS (Cumulative Layout Shift): < 0.1
- INP (Interaction to Next Paint): < 200ms
</context>

<tasks>

<task type="auto">
  <name>Task 1: Optimize font loading for LCP</name>
  <files>src/app/layout.tsx</files>
  <action>
Update Manrope font configuration to optimize loading:
1. Add `display: 'swap'` to prevent FOIT (Flash of Invisible Text)
2. Add `preload: true` to prioritize font loading
3. Add font weight subset `weight: ['400', '500', '600', '700']` to reduce download size

This reduces LCP by ensuring text renders immediately with fallback font, then swaps to Manrope.
  </action>
  <verify>npm run build succeeds; font config includes display: 'swap' and preload: true</verify>
  <done>Font configuration optimized with swap display, preload, and weight subsetting</done>
</task>

<task type="auto">
  <name>Task 2: Add priority loading to above-the-fold images</name>
  <files>src/components/patterns/blurredImage.tsx</files>
  <action>
Add optional `priority` prop to BlurredImage component:
1. Add `priority?: boolean` to interface (default: false)
2. Pass `priority` prop to the Image component
3. When priority is true, also set `loading="eager"`

The priority prop tells Next.js to preload the image, improving LCP for hero images. Keep default as false so most images lazy-load.
  </action>
  <verify>BlurredImage component accepts priority prop and passes it to Image</verify>
  <done>BlurredImage supports priority loading for above-the-fold images</done>
</task>

<task type="auto">
  <name>Task 3: Create skeleton loading component for CLS prevention</name>
  <files>src/components/ui/skeleton.tsx</files>
  <action>
Create a reusable Skeleton component for loading states:
1. Base Skeleton component with animate-pulse and glassmorphic styling
2. Export variants: SkeletonCard, SkeletonText, SkeletonAvatar
3. Use consistent aspect ratios matching actual content (4/3 for deal cards)

Pattern:
```tsx
export function Skeleton({ className }: { className?: string }) {
  return (
    <div className={`animate-pulse bg-glass-bg rounded-lg ${className}`} />
  )
}

export function SkeletonCard() {
  return (
    <div className="bg-glass-bg border border-glass-border rounded-2xl overflow-hidden">
      <Skeleton className="aspect-[4/3]" />
      <div className="p-4 space-y-3">
        <Skeleton className="h-5 w-3/4" />
        <Skeleton className="h-4 w-1/2" />
        <Skeleton className="h-6 w-1/3" />
      </div>
    </div>
  )
}
```

This prevents CLS by reserving space while content loads.
  </action>
  <verify>src/components/ui/skeleton.tsx exists with Skeleton and SkeletonCard exports</verify>
  <done>Skeleton components created for loading state placeholders</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] Font config in layout.tsx includes display: 'swap', preload: true, weight array
- [ ] BlurredImage accepts priority prop
- [ ] Skeleton component exists with SkeletonCard variant
- [ ] No TypeScript errors
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Font loading optimized for swap display
- Image priority loading available
- Skeleton component ready for loading states
- Phase 33 complete, v1.3 milestone complete
</success_criteria>

<output>
After completion, create `.planning/phases/33-performance-cwv/33-01-SUMMARY.md`

Include:
- What optimizations were applied
- Impact on Core Web Vitals targets
- Files modified
- v1.3 milestone completion note
</output>
