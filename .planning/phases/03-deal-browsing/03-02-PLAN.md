---
phase: 03-deal-browsing
plan: 02
type: execute
---

<objective>
Build the deals browse page with category filters, grid/list view toggle, and location integration.

Purpose: Create the primary deal discovery interface where consumers browse available deals by treatment type and location.
Output: CategoryFilter component, DealsGrid component, and /deals browse page with location-aware filtering.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@CLAUDE.md

**Prior Phase Summaries:**
@.planning/phases/02-location-discovery/02-01-SUMMARY.md
@.planning/phases/02-location-discovery/02-02-SUMMARY.md
@.planning/phases/03-deal-browsing/03-01-PLAN.md

**Depends on:** 03-01-PLAN (DealCard, DealCardSkeleton), Phase 2 (location context)

**Location integration from Phase 2:**
- LocationContext provides: state (city, area), cities, getAreasForCity, detectLocation, selectCity, selectArea
- Import: `import { useLocation } from '@/lib/context/locationContext'`
- LocationDisplay component in layout/ for header display (already wrapped in provider)

**Browse page requirements:**
- Grid/list view toggle
- Category filter chips (All, Botox, Fillers, Facials, Laser)
- Responsive grid layout
- Empty state when no deals match
- Loading state with skeletons
- Location-aware: filter deals by selected city/area

**Component architecture:**
- CategoryFilter goes in components/patterns/ (reusable composition)
- DealsGrid goes in components/features/ (domain-specific layout)
- Browse page at src/app/deals/page.tsx

**Mock data utilities from Phase 1-03:**
- getActiveDeals(), getDealsByCategory(), getDealsByCity()
- filterDeals(filters: DealFilters), sortDeals(deals, sortBy)
- DealFilters type: { category?, city?, minPrice?, maxPrice?, minDiscount? }
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CategoryFilter component</name>
  <files>src/components/patterns/categoryFilter.tsx</files>
  <action>
Create src/components/patterns/categoryFilter.tsx with treatment category chips.

'use client' directive required for onClick handlers.

Props interface:
- selected: TreatmentCategory | 'all'
- onChange: (category: TreatmentCategory | 'all') => void

Category options with Phosphor icons:
- { value: 'all', label: 'All Deals', icon: null }
- { value: 'botox', label: 'Botox', icon: Syringe }
- { value: 'fillers', label: 'Fillers', icon: Drop }
- { value: 'facials', label: 'Facials', icon: Sparkle }
- { value: 'laser', label: 'Laser', icon: Sun }

Styling:
- Container: flex flex-wrap gap-2
- Each button: inline-flex items-center gap-1.5 px-4 py-2 rounded-full text-sm font-medium transition-all duration-200
- Selected state: bg-brand-primary text-white shadow-md
- Unselected state: bg-glass-bg border border-glass-border text-text-secondary hover:text-text-primary hover:border-glass-border-hover
- Icon weight: 'fill' when selected, 'regular' when not
  </action>
  <verify>Component renders, clicking chips triggers onChange, selected state visible with brand color</verify>
  <done>CategoryFilter with 5 treatment category chips and All option</done>
</task>

<task type="auto">
  <name>Task 2: Create DealsGrid component</name>
  <files>src/components/features/dealsGrid.tsx</files>
  <action>
Create src/components/features/dealsGrid.tsx with grid/list toggle and states.

'use client' for useState.

Props interface:
- deals: AnonymousDeal[]
- isLoading?: boolean (default false)
- onDealClick?: (dealId: string) => void

Internal state:
- viewMode: 'grid' | 'list' (default 'grid')

Structure:
1. ViewModeToggle component (inline or separate):
   - Container: flex items-center gap-1 p-1 bg-glass-bg rounded-lg border border-glass-border
   - Grid button: SquaresFour icon, selected shows bg-brand-primary/20 text-brand-primary
   - List button: List icon, same selected styling
   - aria-label for accessibility

2. Loading state (isLoading=true):
   - Show ViewModeToggle (disabled)
   - Render 6 DealCardSkeleton components with current viewMode

3. Empty state (deals.length === 0):
   - Centered container: flex flex-col items-center justify-center py-16
   - MagnifyingGlass icon in circular bg-glass-bg container
   - "No deals found" heading
   - Helpful message about adjusting filters

4. Normal state:
   - Header row: deal count + ViewModeToggle
   - Grid layout:
     - grid: grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4
     - list: flex flex-col gap-4
   - Map deals to DealCard with variant={viewMode}
  </action>
  <verify>Grid renders deals, toggle switches views correctly, empty/loading states work</verify>
  <done>DealsGrid with grid/list toggle, responsive layout, loading and empty states</done>
</task>

<task type="auto">
  <name>Task 3: Create deals browse page with location integration</name>
  <files>src/app/deals/page.tsx</files>
  <action>
Create src/app/deals/page.tsx as the main browse page.

'use client' for state management and useLocation hook.

Imports:
- useLocation from @/lib/context/locationContext
- useRouter from next/navigation
- CategoryFilter from @/components/patterns/categoryFilter
- DealsGrid from @/components/features/dealsGrid
- getActiveDeals, getDealsByCategory from @/lib/mock-data
- MapPin from @phosphor-icons/react

State:
- selectedCategory: TreatmentCategory | 'all' (default 'all')

Location integration:
- const { state: locationState } = useLocation()
- Display current city: locationState.city?.name || 'All Locations'
- "Change" button links to location modal (for future, just show text for now)

Deal filtering with useMemo:
1. Get base deals by category (all or filtered)
2. If locationState.city is set, filter by city using filterDeals({ city: locationState.city.name })
3. Return filtered array

Page structure:
- main className="pt-20 pb-20 md:pb-8 px-4 sm:px-6 lg:px-8"
- Container: max-w-7xl mx-auto

Sections:
1. Page Header (mb-8):
   - h1: "Deals Near You" (or "All Deals" if no location)
   - Location row: MapPin icon + city name + "Change" link

2. CategoryFilter (mb-6)

3. DealsGrid with filtered deals

onClick handler: router.push(`/deals/${dealId}`)
  </action>
  <verify>Page loads at /deals, shows location from context, category filter works, deals display in grid, navigation to detail works</verify>
  <done>Browse page at /deals with location-aware filtering and category filter</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] CategoryFilter renders all 5 category options plus "All"
- [ ] Selected category shows brand-primary styling
- [ ] DealsGrid switches between grid and list views
- [ ] Empty state displays when no deals match filters
- [ ] Loading state shows skeletons
- [ ] /deals page loads and displays deals
- [ ] Location from context is displayed (test by changing city in homepage)
- [ ] Clicking a deal navigates to /deals/[id]
- [ ] `npm run build` succeeds
- [ ] `npm run lint` passes
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Category filtering works correctly
- Location filtering uses Phase 2 context (not placeholder)
- Grid/list view toggle functional
- Responsive layout works on all breakpoints
- Navigation to deal details working
</success_criteria>

<output>
After completion, create `.planning/phases/03-deal-browsing/03-02-SUMMARY.md`
</output>
