---
phase: 03-deal-browsing
plan: 04
type: execute
---

<objective>
Build the deal detail page with full pricing breakdown and claim CTA.

Purpose: Provide comprehensive deal information while maintaining the anonymous business display until user verification.
Output: Deal detail page at /deals/[id] with PricingBreakdown and ClaimCTA components.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@CLAUDE.md

**Prior Phase Summaries:**
@.planning/phases/01-foundation/01-02-SUMMARY.md
@.planning/phases/01-foundation/01-03-SUMMARY.md
@.planning/phases/03-deal-browsing/03-01-PLAN.md

**Depends on:** 03-01-PLAN (DealCard patterns), Phase 1 (design system, mock data)

**Deal detail requirements:**
- Dynamic route /deals/[id]
- Full pricing breakdown with unit calculations
- Treatment information and description
- Terms and conditions
- Location area (not specific address)
- Business rating (but name hidden)
- Claim CTA with auth wall message
- Back navigation to /deals

**"Anonymous Until Committed" display:**
- Show: title, full description, pricing, category, location area, rating, claim count
- Hide: business name, address, phone, specific location
- Show: "Create an account to reveal business details and claim this deal"

**Mock data utilities from Phase 1-03:**
- getAnonymousDealById(id): AnonymousDeal | undefined
- AnonymousDeal includes: locationArea, businessRating, businessReviewCount, businessTier

**Design system components:**
- Card from @/components/ui/card (variant="glass")
- Badge from @/components/ui/badge (variant="brand", "default")
- Button from @/components/ui/button

**Component architecture:**
- PricingBreakdown goes in components/features/ (domain logic for calculations)
- ClaimCTA goes in components/features/ (auth wall pattern)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PricingBreakdown component</name>
  <files>src/components/features/pricingBreakdown.tsx</files>
  <action>
Create src/components/features/pricingBreakdown.tsx for detailed pricing display.

No 'use client' needed - pure display component.

Props interface:
- deal: AnonymousDeal (from @/types)

Calculations:
- savings = originalPrice - dealPrice
- hasUnitRange = deal.minUnits || deal.maxUnits
- exampleUnits = minUnits ?? 20 (for calculation example)
- exampleTotal = dealPrice * exampleUnits
- exampleSavings = savings * exampleUnits

Structure using Card variant="glass" padding="lg":

1. Main Pricing section:
   - Deal price: text-3xl sm:text-4xl font-bold text-brand-primary + unit
   - Discount badge: Badge variant="brand" size="md"
   - Original price struck through + savings in green-400

2. Unit Range section (if hasUnitRange):
   - Calculator icon + "Unit Requirements" label
   - Grid of min/max boxes (bg-bg-tertiary rounded-lg p-3)

3. Example Calculation section (if hasUnitRange):
   - "Example: X units" label
   - Regular price (struck through)
   - Deal price
   - "You save" in green-400

4. Validity section:
   - "Valid: [start date] — [end date]" formatted with toLocaleDateString()
   - text-sm text-text-tertiary

Use border-t border-glass-border pt-4 for section dividers.
  </action>
  <verify>Component renders with deal data, calculations are correct, all sections display properly</verify>
  <done>PricingBreakdown component with pricing, savings, unit calculations, and validity dates</done>
</task>

<task type="auto">
  <name>Task 2: Create ClaimCTA component</name>
  <files>src/components/features/claimCTA.tsx</files>
  <action>
Create src/components/features/claimCTA.tsx with auth wall messaging.

'use client' for onClick handlers.

Props interface:
- dealId: string
- onSignUp?: () => void
- onSignIn?: () => void

Structure using Card variant="glass" padding="lg":

Auth wall version (default, since no auth yet):
1. Lock icon: centered, w-16 h-16 rounded-full bg-brand-primary/10 with Lock icon (size=32, weight="fill", text-brand-primary)

2. Message:
   - h3: "Business Details Hidden" (text-lg font-semibold text-text-primary)
   - p: "Create a free account to reveal the business name, location, and contact details — then claim this deal."

3. Actions:
   - Primary button: UserPlus icon + "Create Free Account" (Button size="lg" className="w-full")
   - Secondary link: "Already have an account? Sign in" (text link with brand-primary)

4. Trust indicator: text-xs text-text-muted centered
   "Your information is secure and never shared without permission."

Note: The authenticated version will be implemented in Phase 4/5. For now, always show auth wall.
  </action>
  <verify>Component renders auth wall message, buttons trigger callbacks, styling matches design</verify>
  <done>ClaimCTA component with auth wall messaging and sign up/sign in actions</done>
</task>

<task type="auto">
  <name>Task 3: Create deal detail page</name>
  <files>src/app/deals/[id]/page.tsx</files>
  <action>
Create src/app/deals/[id]/page.tsx as Server Component.

Note: Next.js 15+ uses async params. Handle with: `const { id } = await params`

Imports:
- notFound from next/navigation
- Link from next/link
- getAnonymousDealById from @/lib/mock-data
- Card, Badge from @/components/ui/
- PricingBreakdown, ClaimCTA from @/components/features/
- Phosphor icons: Star, MapPin, Tag, Clock, Info, ArrowLeft

Category labels mapping (same as DealCard):
- botox: 'Botox', fillers: 'Fillers', facials: 'Facials', laser: 'Laser', body: 'Body', skincare: 'Skincare'

Page structure (main className="pt-20 pb-20 md:pb-8 px-4 sm:px-6 lg:px-8"):
1. Container: max-w-5xl mx-auto

2. Back link: Link to /deals with ArrowLeft icon, text-sm text-text-secondary hover:text-text-primary

3. Two-column grid: grid grid-cols-1 lg:grid-cols-3 gap-6

Left column (lg:col-span-2 space-y-6):
- Hero image: aspect-video bg-bg-tertiary rounded-2xl
  - If imageUrl: img with object-cover
  - Else: Tag icon placeholder
  - Category badge (variant="default") + Featured badge if applicable
  - Sponsored indicator if isSponsored

- Title & meta:
  - h1: text-2xl sm:text-3xl font-bold
  - Meta row: MapPin + locationArea, Star (amber-400) + rating, Clock + claimCount

- Description: Card variant="glass" with "About This Deal" heading

- Terms: Card variant="glass" with Info icon and "Terms & Conditions"

Right column (space-y-6):
- PricingBreakdown
- ClaimCTA
- Verified badge (if businessTier === 'paid'): Card with Star icon + "Verified Business — Premium partner"

Error handling:
- If getAnonymousDealById returns undefined, call notFound()
  </action>
  <verify>Page loads at /deals/[id], shows all deal info, 404 for invalid ID, layout is responsive</verify>
  <done>Deal detail page with full content, pricing breakdown, and claim CTA</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete deal detail page with pricing breakdown, auth wall CTA, and responsive layout</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:3000/deals
    3. Click on any deal card
    4. Verify deal detail page displays:
       - Back to deals link
       - Hero image or placeholder
       - Deal title and description
       - Location area and rating with claim count
       - Pricing breakdown with savings calculation
       - "Business Details Hidden" lock message
       - "Create Free Account" CTA button
       - Terms and conditions section
    5. Test invalid ID: Visit /deals/invalid-id — should show 404 page
    6. Test responsive: Resize to mobile width — sidebar should stack below main content
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] PricingBreakdown shows correct calculations
- [ ] ClaimCTA displays auth wall message with lock icon
- [ ] Deal detail page loads with all sections
- [ ] Back to deals link navigates correctly
- [ ] 404 returned for non-existent deal IDs
- [ ] Two-column layout on desktop, stacked on mobile
- [ ] Verified badge shows for paid tier businesses
- [ ] `npm run build` succeeds
- [ ] `npm run lint` passes
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Human verification approved
- Anonymous display maintained (no business details shown)
- Pricing breakdown is accurate
- Auth wall messaging is clear and actionable
- Responsive layout works correctly
</success_criteria>

<output>
After completion, create `.planning/phases/03-deal-browsing/03-04-SUMMARY.md`
</output>
