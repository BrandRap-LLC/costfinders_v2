---
phase: 03-deal-browsing
plan: 04
type: execute
---

<objective>
Build the deal detail page with full pricing breakdown and claim CTA.

Purpose: Provide comprehensive deal information while maintaining the anonymous business display until user verification.
Output: Deal detail page at /deals/[id] with PricingBreakdown and ClaimCTA components.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@CLAUDE.md
@.planning/phases/03-deal-browsing/03-01-PLAN.md

**Depends on:** 03-01-PLAN (DealCard patterns), Phase 1 (design system, mock data)

**Deal detail requirements:**
- Dynamic route /deals/[id]
- Full pricing breakdown with unit calculations
- Treatment information and description
- Terms and conditions
- Location area (not specific address)
- Business rating (but name hidden)
- Claim CTA with auth wall message
- Related deals section (optional)

**"Anonymous Until Committed" display:**
- Show: title, full description, pricing, category, location area, rating
- Hide: business name, address, phone, specific location
- Show: "Create an account to reveal business details and claim this deal"

**Mock data utilities:**
- getAnonymousDealById(id) - returns AnonymousDeal or undefined
- 404 if deal not found
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PricingBreakdown component</name>
  <files>src/components/features/pricingBreakdown.tsx</files>
  <action>
Create src/components/features/pricingBreakdown.tsx:

```tsx
import { Tag, Percent, Calculator } from '@phosphor-icons/react'
import { Card } from '@/components/ui/card'
import { Badge } from '@/components/ui/badge'
import type { AnonymousDeal } from '@/types'

interface PricingBreakdownProps {
  deal: AnonymousDeal
}

export function PricingBreakdown({ deal }: PricingBreakdownProps) {
  const savings = deal.originalPrice - deal.dealPrice
  const hasUnitRange = deal.minUnits || deal.maxUnits

  // Calculate example totals if unit-based pricing
  const exampleUnits = deal.minUnits ?? 20
  const exampleTotal = deal.dealPrice * exampleUnits
  const exampleSavings = savings * exampleUnits

  return (
    <Card variant="glass" padding="lg" className="space-y-6">
      {/* Main Pricing */}
      <div>
        <div className="flex items-start justify-between mb-4">
          <div>
            <span className="text-3xl sm:text-4xl font-bold text-brand-primary">
              ${deal.dealPrice}
            </span>
            <span className="text-lg text-text-tertiary ml-2">
              {deal.unit}
            </span>
          </div>
          <Badge variant="brand" size="md">
            {deal.discountPercent}% OFF
          </Badge>
        </div>

        <div className="flex items-center gap-4 text-sm text-text-secondary">
          <span className="line-through">${deal.originalPrice} {deal.unit}</span>
          <span className="text-green-400">Save ${savings.toFixed(2)} {deal.unit}</span>
        </div>
      </div>

      {/* Unit Range Info */}
      {hasUnitRange && (
        <div className="pt-4 border-t border-glass-border">
          <div className="flex items-center gap-2 text-sm text-text-secondary mb-3">
            <Calculator size={16} />
            <span>Unit Requirements</span>
          </div>
          <div className="grid grid-cols-2 gap-4">
            {deal.minUnits && (
              <div className="bg-bg-tertiary rounded-lg p-3">
                <p className="text-xs text-text-muted mb-1">Minimum</p>
                <p className="text-lg font-semibold text-text-primary">{deal.minUnits} units</p>
              </div>
            )}
            {deal.maxUnits && (
              <div className="bg-bg-tertiary rounded-lg p-3">
                <p className="text-xs text-text-muted mb-1">Maximum</p>
                <p className="text-lg font-semibold text-text-primary">{deal.maxUnits} units</p>
              </div>
            )}
          </div>
        </div>
      )}

      {/* Example Calculation */}
      {hasUnitRange && (
        <div className="pt-4 border-t border-glass-border">
          <p className="text-sm text-text-muted mb-3">
            Example: {exampleUnits} units
          </p>
          <div className="space-y-2">
            <div className="flex justify-between text-sm">
              <span className="text-text-secondary">Regular price</span>
              <span className="text-text-tertiary line-through">
                ${(deal.originalPrice * exampleUnits).toFixed(2)}
              </span>
            </div>
            <div className="flex justify-between text-sm">
              <span className="text-text-secondary">Deal price</span>
              <span className="text-text-primary font-medium">
                ${exampleTotal.toFixed(2)}
              </span>
            </div>
            <div className="flex justify-between text-sm pt-2 border-t border-glass-border">
              <span className="text-green-400">You save</span>
              <span className="text-green-400 font-semibold">
                ${exampleSavings.toFixed(2)}
              </span>
            </div>
          </div>
        </div>
      )}

      {/* Validity */}
      <div className="pt-4 border-t border-glass-border text-sm text-text-tertiary">
        <p>
          Valid: {new Date(deal.validFrom).toLocaleDateString()} — {new Date(deal.validUntil).toLocaleDateString()}
        </p>
      </div>
    </Card>
  )
}
```

Key implementation notes:
- Shows deal price prominently with discount badge
- Strikethrough original price with savings amount
- Unit range display (min/max if applicable)
- Example calculation for unit-based pricing
- Validity dates at bottom
- Glassmorphic card styling
  </action>
  <verify>Component renders with deal data, calculations are correct, styling matches design system</verify>
  <done>PricingBreakdown component with pricing, savings, unit calculations, and validity</done>
</task>

<task type="auto">
  <name>Task 2: Create ClaimCTA component</name>
  <files>src/components/features/claimCTA.tsx</files>
  <action>
Create src/components/features/claimCTA.tsx with auth wall messaging:

```tsx
'use client'

import { Lock, UserPlus, ArrowRight } from '@phosphor-icons/react'
import { Card } from '@/components/ui/card'
import { Button } from '@/components/ui/button'

interface ClaimCTAProps {
  dealId: string
  onSignUp?: () => void
  onSignIn?: () => void
}

export function ClaimCTA({ dealId, onSignUp, onSignIn }: ClaimCTAProps) {
  // TODO: Check auth state when auth is implemented
  const isAuthenticated = false

  if (isAuthenticated) {
    // This will be implemented in Phase 4/5
    return (
      <Card variant="glass" padding="lg">
        <Button size="lg" className="w-full">
          Claim This Deal
          <ArrowRight size={18} weight="bold" />
        </Button>
      </Card>
    )
  }

  return (
    <Card variant="glass" padding="lg" className="space-y-4">
      {/* Lock Icon */}
      <div className="flex justify-center">
        <div className="w-16 h-16 rounded-full bg-brand-primary/10 flex items-center justify-center">
          <Lock size={32} weight="fill" className="text-brand-primary" />
        </div>
      </div>

      {/* Message */}
      <div className="text-center">
        <h3 className="text-lg font-semibold text-text-primary mb-2">
          Business Details Hidden
        </h3>
        <p className="text-sm text-text-secondary">
          Create a free account to reveal the business name, location, and contact details — then claim this deal.
        </p>
      </div>

      {/* Actions */}
      <div className="space-y-3 pt-2">
        <Button
          size="lg"
          className="w-full"
          onClick={onSignUp}
        >
          <UserPlus size={18} weight="bold" />
          Create Free Account
        </Button>
        <button
          onClick={onSignIn}
          className="w-full text-sm text-text-secondary hover:text-brand-primary transition-colors text-center"
        >
          Already have an account? <span className="text-brand-primary font-medium">Sign in</span>
        </button>
      </div>

      {/* Trust indicator */}
      <p className="text-xs text-text-muted text-center pt-2">
        Your information is secure and never shared without permission.
      </p>
    </Card>
  )
}
```

Key implementation notes:
- Shows lock icon with "Business Details Hidden" message
- Explains the value proposition (create account → reveal → claim)
- Primary CTA for account creation
- Secondary link for existing users to sign in
- Trust indicator text
- Placeholder for authenticated state (Phase 4/5)
  </action>
  <verify>Component renders auth wall message, buttons trigger callbacks, styling matches design system</verify>
  <done>ClaimCTA component with auth wall messaging and sign up/sign in actions</done>
</task>

<task type="auto">
  <name>Task 3: Create deal detail page</name>
  <files>src/app/deals/[id]/page.tsx</files>
  <action>
Create src/app/deals/[id]/page.tsx:

```tsx
import { notFound } from 'next/navigation'
import { Star, MapPin, Tag, Clock, Info, ArrowLeft } from '@phosphor-icons/react'
import Link from 'next/link'
import { getAnonymousDealById } from '@/lib/mock-data'
import { Badge } from '@/components/ui/badge'
import { Card } from '@/components/ui/card'
import { PricingBreakdown } from '@/components/features/pricingBreakdown'
import { ClaimCTA } from '@/components/features/claimCTA'
import type { TreatmentCategory } from '@/types'

const categoryLabels: Record<TreatmentCategory, string> = {
  botox: 'Botox',
  fillers: 'Fillers',
  facials: 'Facials',
  laser: 'Laser',
  body: 'Body',
  skincare: 'Skincare',
}

interface DealPageProps {
  params: Promise<{ id: string }>
}

export default async function DealPage({ params }: DealPageProps) {
  const { id } = await params
  const deal = getAnonymousDealById(id)

  if (!deal) {
    notFound()
  }

  return (
    <main className="pt-20 pb-20 md:pb-8 px-4 sm:px-6 lg:px-8">
      <div className="max-w-5xl mx-auto">
        {/* Back Link */}
        <Link
          href="/deals"
          className="inline-flex items-center gap-1.5 text-sm text-text-secondary hover:text-text-primary transition-colors mb-6"
        >
          <ArrowLeft size={16} />
          Back to deals
        </Link>

        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
          {/* Main Content - Left Column */}
          <div className="lg:col-span-2 space-y-6">
            {/* Hero Image */}
            <div className="relative aspect-video bg-bg-tertiary rounded-2xl overflow-hidden">
              {deal.imageUrl ? (
                <img
                  src={deal.imageUrl}
                  alt={deal.title}
                  className="w-full h-full object-cover"
                />
              ) : (
                <div className="w-full h-full flex items-center justify-center">
                  <Tag size={64} weight="light" className="text-text-muted" />
                </div>
              )}

              {/* Badges */}
              <div className="absolute top-4 left-4 flex gap-2">
                <Badge variant="default" size="md">
                  {categoryLabels[deal.category]}
                </Badge>
                {deal.isFeatured && (
                  <Badge variant="brand" size="md">Featured</Badge>
                )}
              </div>

              {deal.isSponsored && (
                <span className="absolute bottom-4 left-4 text-xs text-text-muted bg-black/50 px-2 py-1 rounded">
                  Sponsored
                </span>
              )}
            </div>

            {/* Title & Meta */}
            <div>
              <h1 className="text-2xl sm:text-3xl font-bold text-text-primary mb-4">
                {deal.title}
              </h1>

              <div className="flex flex-wrap items-center gap-4 text-sm text-text-secondary">
                <div className="flex items-center gap-1.5">
                  <MapPin size={16} weight="fill" className="text-text-tertiary" />
                  <span>{deal.locationArea}</span>
                </div>
                <div className="flex items-center gap-1.5">
                  <Star size={16} weight="fill" className="text-amber-400" />
                  <span>{deal.businessRating.toFixed(1)}</span>
                  <span className="text-text-muted">({deal.businessReviewCount} reviews)</span>
                </div>
                <div className="flex items-center gap-1.5">
                  <Clock size={16} weight="regular" className="text-text-tertiary" />
                  <span>{deal.claimCount} claimed</span>
                </div>
              </div>
            </div>

            {/* Description */}
            <Card variant="glass" padding="lg">
              <h2 className="text-lg font-semibold text-text-primary mb-3">
                About This Deal
              </h2>
              <p className="text-text-secondary leading-relaxed">
                {deal.description}
              </p>
            </Card>

            {/* Terms & Conditions */}
            <Card variant="glass" padding="lg">
              <div className="flex items-start gap-3">
                <Info size={20} className="text-text-tertiary shrink-0 mt-0.5" />
                <div>
                  <h3 className="text-sm font-semibold text-text-primary mb-2">
                    Terms & Conditions
                  </h3>
                  <p className="text-sm text-text-secondary">
                    {deal.termsAndConditions}
                  </p>
                </div>
              </div>
            </Card>
          </div>

          {/* Sidebar - Right Column */}
          <div className="space-y-6">
            {/* Pricing Breakdown */}
            <PricingBreakdown deal={deal} />

            {/* Claim CTA */}
            <ClaimCTA
              dealId={deal.id}
              onSignUp={() => {
                // TODO: Navigate to sign up with redirect back
              }}
              onSignIn={() => {
                // TODO: Navigate to sign in with redirect back
              }}
            />

            {/* Business Tier Indicator */}
            {deal.businessTier === 'paid' && (
              <Card variant="glass" padding="md">
                <div className="flex items-center gap-2 text-sm">
                  <Star size={16} weight="fill" className="text-brand-primary" />
                  <span className="text-text-secondary">
                    <span className="text-text-primary font-medium">Verified Business</span>
                    {' '}— Premium partner
                  </span>
                </div>
              </Card>
            )}
          </div>
        </div>
      </div>
    </main>
  )
}
```

Key implementation notes:
- Server Component (no 'use client' needed for initial render)
- Dynamic params with Next.js 15+ Promise pattern
- Returns notFound() if deal doesn't exist
- Two-column layout: main content + sidebar
- Hero image with category and featured badges
- Meta row with location, rating, claim count
- Description and T&C in glassmorphic cards
- PricingBreakdown and ClaimCTA in sidebar
- Verified badge for paid tier businesses
- Back link to /deals
  </action>
  <verify>Page loads at /deals/[id], shows deal details, 404 for invalid ID, layout is responsive</verify>
  <done>Deal detail page with full content, pricing breakdown, and claim CTA</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete deal detail page with pricing breakdown, auth wall CTA, and responsive layout</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:3000/deals
    3. Click on any deal card
    4. Verify deal detail page displays:
       - Hero image or placeholder
       - Deal title and description
       - Location area and rating
       - Pricing breakdown with savings calculation
       - "Business Details Hidden" lock message
       - "Create Free Account" CTA button
    5. Test invalid ID: Visit /deals/invalid-id — should show 404
    6. Test responsive: Resize to mobile width — sidebar should stack below main content
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] PricingBreakdown shows correct calculations
- [ ] ClaimCTA displays auth wall message with lock icon
- [ ] Deal detail page loads with all sections
- [ ] 404 returned for non-existent deal IDs
- [ ] Back to deals link works
- [ ] Two-column layout on desktop, stacked on mobile
- [ ] `npm run build` succeeds
- [ ] `npm run lint` passes
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Human verification approved
- Anonymous display maintained (no business details shown)
- Pricing breakdown is accurate
- Auth wall messaging is clear and actionable
</success_criteria>

<output>
After completion, create `.planning/phases/03-deal-browsing/03-04-SUMMARY.md`
</output>
